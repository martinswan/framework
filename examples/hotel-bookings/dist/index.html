<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Bookings by market segment | Hotel Bookings</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.14/_esm.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/_esm.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/_esm.js">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./data/hotels.csv", {"name":"./data/hotels.csv","mimeType":"text/csv","path":"./_file/data/hotels.6f38fda1.csv","lastModified":1715112029227});

define({id: "02826274", inline: true, inputs: ["pickMarketSegment","display"], body: async (pickMarketSegment,display) => {
display(await(
pickMarketSegment == "Groups" ? "Group" : pickMarketSegment
))
}});

define({id: "974da897", inputs: ["view","Inputs","hotelData"], outputs: ["pickMarketSegment"], body: (view,Inputs,hotelData) => {
const pickMarketSegment = view(
  Inputs.radio(
    hotelData
      .filter((d) => d.MarketSegment != "Complementary")
      .map((d) => d.MarketSegment),
    {
      label: "Choose booking type:",
      value: "Online travel agent",
      unique: true,
    }
  )
);
return {pickMarketSegment};
}});

define({id: "609a833d", inline: true, inputs: ["resize","chartFunction","byCountry","display"], body: async (resize,chartFunction,byCountry,display) => {
display(await(
resize(width => chartFunction(byCountry, "By country", width))
))
}});

define({id: "3bcf34e1", inline: true, inputs: ["resize","chartFunction","byBookingOutcome","display"], body: async (resize,chartFunction,byBookingOutcome,display) => {
display(await(
resize(width => chartFunction(byBookingOutcome, "Cancellations", width))
))
}});

define({id: "c772896a", inline: true, inputs: ["resize","chartFunction","bookingSeason","display"], body: async (resize,chartFunction,bookingSeason,display) => {
display(await(
resize(width => chartFunction(bookingSeason, "By season", width))
))
}});

define({id: "749c0b9d", inline: true, inputs: ["display","totalBookingsBAN"], body: (display,totalBookingsBAN) => {
display(totalBookingsBAN)
}});

define({id: "8f7c3fed", inline: true, inputs: ["display","rateBAN"], body: (display,rateBAN) => {
display(rateBAN)
}});

define({id: "4180ef12", inline: true, inputs: ["resize","arrivalDateChart","display"], body: async (resize,arrivalDateChart,display) => {
display(await(
resize((width, height) => arrivalDateChart(width, height))
))
}});

define({id: "20d77930", inline: true, inputs: ["resize","leadTimeChart","display"], body: async (resize,leadTimeChart,display) => {
display(await(
resize((width, height) => leadTimeChart(width, height))
))
}});

define({id: "068e9653", inline: true, inputs: ["resize","dailyRateChart","display"], body: async (resize,dailyRateChart,display) => {
display(await(
resize((width, height) => dailyRateChart(width, height))
))
}});

define({id: "0fc56e89", inline: true, inputs: ["display","Inputs","bookingsByMarketSegment"], body: (display,Inputs,bookingsByMarketSegment) => {
display(Inputs.table(bookingsByMarketSegment))
}});

define({id: "a4f30fc6", inputs: ["drawBAN","d3","bookingsByMarketSegment"], outputs: ["totalBookingsBAN"], body: (drawBAN,d3,bookingsByMarketSegment) => {
const totalBookingsBAN = drawBAN(
  `${d3.format(",")(bookingsByMarketSegment.length)}`,
  `Total bookings`,
  "#ccc"
);
return {totalBookingsBAN};
}});

define({id: "8291bd3d", inputs: ["drawBAN","d3","bookingsByMarketSegment"], outputs: ["rateBAN"], body: (drawBAN,d3,bookingsByMarketSegment) => {
const rateBAN = drawBAN(
  `$ ${d3.mean(bookingsByMarketSegment.map((d) => d.ADR)).toFixed(2)}`,
  `Average daily rate`,
  `#ccc`
);
return {rateBAN};
}});

define({id: "950056e4", inputs: ["drawBAN","d3","bookingsByMarketSegment"], outputs: ["bookingLeadBAN"], body: (drawBAN,d3,bookingsByMarketSegment) => {
const bookingLeadBAN = drawBAN(
  `${d3.median(bookingsByMarketSegment, (d) => d.LeadTime)} days`,
  `Median booking lead time`,
  `#ccc`
);
return {bookingLeadBAN};
}});

define({id: "eda712bc", inputs: ["drawBAN","d3","bookingsByMarketSegment"], outputs: ["cancellationBAN"], body: (drawBAN,d3,bookingsByMarketSegment) => {
const cancellationBAN = drawBAN(
  `${d3.format(".1f")(
    (bookingsByMarketSegment.filter((d) => d.IsCanceled == "Cancelled").length /
      bookingsByMarketSegment.length) *
      100
  )}%`,
  `Cancellation rate`,
  `#ccc`
);
return {cancellationBAN};
}});

define({id: "0708a3f1", inputs: ["chartFunction","bookingSeason","width"], outputs: ["bySeasonDonut"], body: (chartFunction,bookingSeason,width) => {
const bySeasonDonut = chartFunction(bookingSeason, "By season", width);
return {bySeasonDonut};
}});

define({id: "43a79322", inputs: ["Plot","pickMarketSegment","bookingsByMarketSegment","d3"], outputs: ["arrivalDateChart"], body: (Plot,pickMarketSegment,bookingsByMarketSegment,d3) => {
function arrivalDateChart(width, height) {
  return Plot.plot({
    height: height - 50,
    marginBottom: 35,
    width,
    x: { label: "Arrival date" },
    y: { label: "Bookings", grid: true },
    title: `${pickMarketSegment} bookings by arrival date`,
    caption: "Daily counts and 28-day moving average.",
    marks: [
      Plot.lineY(
        bookingsByMarketSegment,
        Plot.binX(
          { y: "count" },
          {
            x: "arrivalDate",
            interval: d3.utcDay,
            opacity: 0.2,
            strokeWidth: 2,
          }
        )
      ),
      Plot.lineY(
        bookingsByMarketSegment,
        Plot.windowY(
          { k: 28 },
          Plot.binX(
            { y: "count" },
            {
              x: "arrivalDate",
              interval: d3.utcDay,
              strokeWidth: 1,
              stroke: "black",
            }
          )
        )
      ),
      Plot.ruleY([0]),
      Plot.axisX({ ticks: 5 }),
      Plot.axisY({ ticks: 5 }),
    ],
  });
}
return {arrivalDateChart};
}});

define({id: "c7c60975", inputs: ["Plot","bookingsByMarketSegment"], outputs: ["leadTimeChart"], body: (Plot,bookingsByMarketSegment) => {
function leadTimeChart(width, height) {
  return Plot.plot({
    width,
    height: height - 30,
    x: { label: "Booking lead time (days)" },
    y: { grid: true },
    color: { legend: true },
    marks: [
      Plot.ruleY([0]),
      Plot.axisX({ ticks: 5 }),
      Plot.axisY({ ticks: 5 }),
      Plot.rectY(
        bookingsByMarketSegment,
        Plot.binX(
          { y: "count" },
          { x: "LeadTime", interval: 20, fill: "season" }
        )
      ),
    ],
  });
}
return {leadTimeChart};
}});

define({id: "4f115479", inputs: ["Plot","bookingsByMarketSegment"], outputs: ["dailyRateChart"], body: (Plot,bookingsByMarketSegment) => {
function dailyRateChart(width, height) {
  return Plot.plot({
    width,
    height: height - 30,
    x: { label: "Daily rate" },
    y: { grid: true },
    color: { legend: true },
    marks: [
      Plot.ruleY([0]),
      Plot.axisX({ ticks: 5 }),
      Plot.axisY({ ticks: 5 }),
      Plot.rectY(
        bookingsByMarketSegment,
        Plot.binX(
          { y: "count" },
          { x: "ADR", fill: "#21C6A8", interval: 20, fill: "season" }
        )
      ),
    ],
  });
}
return {dailyRateChart};
}});

define({id: "a07e6a90", inputs: ["FileAttachment"], outputs: ["hotels"], body: async (FileAttachment) => {
const hotels = await FileAttachment("./data/hotels.csv").csv({ typed: true });
return {hotels};
}});

define({id: "93aed496", inputs: ["hotels","d3"], outputs: ["hotelData"], body: (hotels,d3) => {
const hotelData = hotels.map((d) => ({
  ...d,
  IsCanceled: d.IsCanceled == 0 ? "Keep" : "Cancel",
  season: ["June", "July", "August"].includes(d.ArrivalDateMonth)
    ? "Summer"
    : ["September", "October", "November"].includes(d.ArrivalDateMonth)
    ? "Fall"
    : ["December", "January", "February"].includes(d.ArrivalDateMonth)
    ? "Winter"
    : "Spring",
  Country: d.Country == "NULL" ? "Unknown" : d.Country,
  Meal: d.Meal.trim(),
  ReservedRoomType: d.ReservedRoomType.trim(),
  AssignedRoomType: d.AssignedRoomType.trim(),
  MarketSegment:
    d.MarketSegment == "Online TA"
      ? "Online travel agent"
      : d.MarketSegment == "Offline TA/TO"
      ? "Offline travel agent / tour operator"
      : d.MarketSegment,
  arrivalDate: d3.timeParse("%B %d, %Y")(
    d.ArrivalDateMonth +
      " " +
      d.ArrivalDateDayOfMonth +
      ", " +
      d.ArrivalDateYear
  ),
}));
return {hotelData};
}});

define({id: "2abffecb", inputs: ["hotelData","pickMarketSegment"], outputs: ["bookingsByMarketSegment"], body: (hotelData,pickMarketSegment) => {
const bookingsByMarketSegment = hotelData.filter(
  (d) =>
    d.MarketSegment == pickMarketSegment && d.MarketSegment != "Complementary"
);
return {bookingsByMarketSegment};
}});

define({id: "06742543", inputs: ["d3","bookingsByMarketSegment"], outputs: ["bookingCountry"], body: (d3,bookingsByMarketSegment) => {
const bookingCountry = d3
  .flatRollup(
    bookingsByMarketSegment,
    (d) => d.length,
    (v) => v.Country
  )
  .map(([name, value]) => ({ name, value }))
  .sort((a, b) => d3.descending(a.value, b.value));
return {bookingCountry};
}});

define({id: "6fbe22da", inputs: ["bookingCountry"], outputs: ["bookingCountryTopN"], body: (bookingCountry) => {
const bookingCountryTopN = bookingCountry.slice(0, 5);
return {bookingCountryTopN};
}});

define({id: "54aabed8", inputs: ["d3","bookingCountry"], outputs: ["bookingCountryOther"], body: (d3,bookingCountry) => {
const bookingCountryOther = {
  name: "Other",
  value: d3.sum(
    bookingCountry.slice(5 - bookingCountry.length),
    (d) => d.value
  ),
};
return {bookingCountryOther};
}});

define({id: "0a1ee577", inputs: ["bookingCountryTopN","bookingCountryOther"], outputs: ["bookingByCountryDonut"], body: (bookingCountryTopN,bookingCountryOther) => {
const bookingByCountryDonut = bookingCountryTopN.concat(bookingCountryOther);
return {bookingByCountryDonut};
}});

define({id: "3e43deef", inputs: ["bookingByCountryDonut"], outputs: ["byCountry"], body: (bookingByCountryDonut) => {
// Bookings by country
const byCountry = bookingByCountryDonut;
return {byCountry};
}});

define({id: "82638652", inputs: ["d3","bookingsByMarketSegment"], outputs: ["byBookingOutcome"], body: (d3,bookingsByMarketSegment) => {
//Booking outcome (cancelled or not cancelled)

const byBookingOutcome = d3
  .flatRollup(
    bookingsByMarketSegment,
    (d) => d.length,
    (d) => d.IsCanceled
  )
  .map(([name, value]) => ({ name, value }))
  .sort((a, b) => d3.descending(a.value, b.value));
return {byBookingOutcome};
}});

define({id: "6611789c", inputs: ["d3","bookingsByMarketSegment"], outputs: ["byRoomType"], body: (d3,bookingsByMarketSegment) => {
// Bookings by Room Type Data
const byRoomType = d3
  .flatRollup(
    bookingsByMarketSegment,
    (d) => d.length,
    (d) => d.ReservedRoomType
  )
  .map(([name, value]) => ({ name, value }))
  .sort((a, b) => d3.descending(a.value, b.value));
return {byRoomType};
}});

define({id: "a755f8a8", inputs: ["d3","bookingsByMarketSegment"], outputs: ["bookingSeason"], body: (d3,bookingsByMarketSegment) => {
const bookingSeason = d3
  .flatRollup(
    bookingsByMarketSegment,
    (d) => d.length,
    (v) => v.season
  )
  .map(([name, value]) => ({ name, value }))
  .sort((a, b) => d3.descending(a.value, b.value));
return {bookingSeason};
}});

define({id: "8215fedc", inputs: ["Plot","width"], outputs: ["drawBAN"], body: (Plot,width) => {
function drawBAN(largeText, subText, borderColor) {
  return Plot.plot({
    width,
    height: 400,
    marks: [
      Plot.text([largeText], {
        frameAnchor: "middle",
        fontSize: 130,
        fontWeight: 700,
        dy: -50,
      }),
      Plot.text([subText], {
        frameAnchor: "middle",
        fontSize: 80,
        dy: 100,
        opacity: 0.8,
      }),
    ],
  });
}
return {drawBAN};
}});

define({id: "fb311a13", inputs: ["d3"], outputs: ["chartFunction"], body: (d3) => {
// Code adapted (barely) from Mike Bostock's Donut chart notebook (https://observablehq.com/@d3/donut-chart/2)

const chartFunction = function (data, centerText, width) {
  const height = Math.min(width, 350);
  const radius = Math.min(width, height) / 2;

  const arc = d3
    .arc()
    .innerRadius(radius * 0.5)
    .outerRadius(radius - 1);

  const pie = d3
    .pie()
    .padAngle(1 / radius)
    .sort(null)
    .value((d) => d.value);

  const color = d3
    .scaleOrdinal()
    .domain(data.map((d) => d.name))
    .range([
      "#4269d0", // blue
      "#efb118", // orange
      "#ff725c", // red
      "#6cc5b0", // cyan
      "#3ca951", // green
      "#ff8ab7", // pink
      "#a463f2", // purple
      "#97bbf5", // light blue
    ]);

  const svg = d3
    .create("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("viewBox", [-width / 2, -height / 2, width, height])
    .attr("style", "max-width: 100%; height: auto;");

  svg
    .append("g")
    .selectAll()
    .data(pie(data))
    .join("path")
    .attr("fill", (d) => color(d.data.name))
    .attr("d", arc)
    .append("title")
    .text((d) => `${d.data.name}: ${d.data.value.toLocaleString()}`);

  svg
    .append("g")
    .attr("font-family", "sans-serif")
    .attr("font-size", 11)
    .attr("text-anchor", "middle")
    .selectAll()
    .data(pie(data))
    .join("text")
    .attr("transform", (d) => `translate(${arc.centroid(d)})`)
    .call((text) =>
      text
        .append("tspan")
        .filter((d) => d.endAngle - d.startAngle > 0.1)
        .attr("y", "-0.5em")
        .attr("font-weight", "bold")
        .text((d) => d.data.name)
    )
    .call((text) =>
      text
        .filter((d) => d.endAngle - d.startAngle > 0.25)
        .append("tspan")
        .attr("x", 0)
        .attr("y", "0.7em")
        .attr("fill-opacity", 0.7)
        .text((d) => d.data.value.toLocaleString("en-US"))
    );

  svg
    .append("text")
    .attr("text-anchor", "middle")
    .attr("font-family", "sans-serif")
    .attr("font-size", 12)
    .attr("font-weight", 700)
    .text(centerText);

  return svg.node();
};
return {chartFunction};
}});

</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<h1 id="bookings-by-market-segment" tabindex="-1"><a class="observablehq-header-anchor" href="#bookings-by-market-segment">Bookings by market segment</a></h1>
<h2 id="reservations" tabindex="-1"><a class="observablehq-header-anchor" href="#reservations"><span id="cell-02826274" class="observablehq--loading"></span> reservations</a></h2>
<div id="cell-974da897" class="observablehq observablehq--block"></div>
<div class="grid grid-cols-4">
<div class="card grid-rowspan-2"><span id="cell-609a833d" class="observablehq--loading"></span></div>
<div class="card grid-rowspan-2"><span id="cell-3bcf34e1" class="observablehq--loading"></span></div>
<div class="card grid-rowspan-2"><span id="cell-c772896a" class="observablehq--loading"></span></div>
<div class="card grid-rowspan-1"><span id="cell-749c0b9d" class="observablehq--loading"></span></div>
<div class="card grid-rowspan-1"><span id="cell-8f7c3fed" class="observablehq--loading"></span></div>
<div class="card grid-colspan-4 grid-rowspan-2"><span id="cell-4180ef12" class="observablehq--loading"></span></div>
<div class="card grid-colspan-2 grid-rowspan-2"><span id="cell-20d77930" class="observablehq--loading"></span></div>
<div class="card grid-colspan-2 grid-rowspan-2"><span id="cell-068e9653" class="observablehq--loading"></span></div>
</div>
<div class="card" style="padding: 0">
<span id="cell-0fc56e89" class="observablehq--loading"></span>;
</div>
<div id="cell-a4f30fc6" class="observablehq observablehq--block"></div>
<div id="cell-8291bd3d" class="observablehq observablehq--block"></div>
<div id="cell-950056e4" class="observablehq observablehq--block"></div>
<div id="cell-eda712bc" class="observablehq observablehq--block"></div>
<div id="cell-0708a3f1" class="observablehq observablehq--block"></div>
<div id="cell-43a79322" class="observablehq observablehq--block"></div>
<div id="cell-c7c60975" class="observablehq observablehq--block"></div>
<div id="cell-4f115479" class="observablehq observablehq--block"></div>
<p><strong>Data source:</strong> Antonio et al (2021). Hotel booking demand datasets. Data in Brief (22): 41-49. <a href="https://doi.org/10.1016/j.dib.2018.11.126" target="_blank" rel="noopener noreferrer">https://doi.org/10.1016/j.dib.2018.11.126</a></p>
<p><strong>Credit:</strong> Donut charts reuse code from <a href="https://observablehq.com/@d3/donut-chart/2" target="_blank" rel="noopener noreferrer">Mike Bostock's <em>Donut chart</em> notebook</a>. Big number boxes are adapted from <a href="https://observablehq.com/d/a156c1245672f9bd" target="_blank" rel="noopener noreferrer">Paul Buffa’s <em>Walmart growth dashboard</em></a>.</p>
<div id="cell-a07e6a90" class="observablehq observablehq--block"></div>
<div id="cell-93aed496" class="observablehq observablehq--block"></div>
<div id="cell-2abffecb" class="observablehq observablehq--block"></div>
<div id="cell-06742543" class="observablehq observablehq--block"></div>
<div id="cell-6fbe22da" class="observablehq observablehq--block"></div>
<div id="cell-54aabed8" class="observablehq observablehq--block"></div>
<div id="cell-0a1ee577" class="observablehq observablehq--block"></div>
<div id="cell-3e43deef" class="observablehq observablehq--block"></div>
<div id="cell-82638652" class="observablehq observablehq--block"></div>
<div id="cell-6611789c" class="observablehq observablehq--block"></div>
<div id="cell-a755f8a8" class="observablehq observablehq--block"></div>
<div id="cell-8215fedc" class="observablehq observablehq--block"></div>
<div id="cell-fb311a13" class="observablehq observablehq--block"></div>
</main>
<footer id="observablehq-footer">
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2024-05-08T05:58:20">May 8, 2024</a>.</div>
</footer>
</div>
